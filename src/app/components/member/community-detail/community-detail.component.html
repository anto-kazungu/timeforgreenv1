<div class="community-detail-container">
  @if (community) {
    <div class="header">
      <button class="back-btn" (click)="goBack()">← Back</button>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>

    <div class="content">
      <div class="community-banner" [style.background]="community.gradient">
        <h1>{{ community.name }}</h1>
        <p class="banner-description">{{ community.description }}</p>
      </div>

      <div class="community-info">
        <div class="info-card">
          <div class="info-item">
            <span class="info-label">Members</span>
            <span class="info-value">{{ community.members }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Category</span>
            <span class="info-value">{{ community.category }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Created</span>
            <span class="info-value">{{ community.dateCreated | date: 'MMM d, yyyy' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Code</span>
            <span class="info-value code">{{ community.code }}</span>
          </div>
        </div>
      </div>

      <div class="feeds-section">
        <div class="section-header">
          <h2>Community Feed</h2>
          <button class="create-post-btn" (click)="togglePostForm()">
            <span class="material-symbols-outlined">add_circle</span>
            {{ showPostForm ? 'Cancel' : 'Create Post' }}
          </button>
        </div>

        @if (showPostForm) {
          <div class="post-form">
            <textarea 
              [(ngModel)]="newPostContent" 
              placeholder="Share something with the community..."
              rows="4"
            ></textarea>
            
            <div class="image-upload-section">
              <input 
                type="file" 
                #fileInput 
                (change)="onImageSelected($event)"
                accept="image/*"
                style="display: none;"
              >
              <button type="button" class="image-upload-btn" (click)="fileInput.click()">
                <span class="material-symbols-outlined">photo_camera</span>
                Add Image
              </button>
              
              @if (selectedImagePreview) {
                <div class="image-preview">
                  <img [src]="selectedImagePreview" alt="Preview" class="preview-image">
                  <button type="button" class="remove-image-btn" (click)="removeImage()">
                    <span class="material-symbols-outlined">close</span>
                  </button>
                </div>
              }
            </div>
            
            <div class="post-form-actions">
              <button class="cancel-post-btn" (click)="cancelPost()">Cancel</button>
              <button class="submit-post-btn" (click)="createPost()" [disabled]="!newPostContent.trim()">
                Post
              </button>
            </div>
          </div>
        }
        
        @if (community.feeds.length === 0) {
          <div class="empty-feed">
            <p>No posts yet. Be the first to share something!</p>
          </div>
        } @else {
          <div class="feeds-list">
            <div class="feed-card" *ngFor="let feed of community.feeds">
              <div class="feed-header">
                <div class="feed-author">
                  <div class="author-avatar">{{ feed.author.charAt(0) }}</div>
                  <div class="author-info">
                    <span class="author-name">{{ feed.author }}</span>
                    <span class="feed-meta">
                      <span class="author-role">Member</span>
                      <span class="separator">•</span>
                      <span class="feed-time">{{ getTimeAgo(feed.timestamp) }}</span>
                    </span>
                  </div>
                </div>
                @if (canDeletePost(feed)) {
                  <div class="post-menu">
                    <button class="post-menu-btn" (click)="togglePostMenu(feed.id)">
                      <span class="material-symbols-outlined">more_vert</span>
                    </button>
                    @if (showMenuForPost === feed.id) {
                      <div class="post-menu-dropdown">
                        <button class="menu-item delete-item" (click)="deletePost(feed.id)">
                          <span class="material-symbols-outlined">delete</span>
                          Delete Post
                        </button>
                      </div>
                    }
                  </div>
                }
              </div>
              
              @if (feed.image) {
                <div class="feed-image">
                  <img [src]="feed.image" alt="Post image" class="post-image">
                </div>
              }
              
              <div class="feed-content">
                <p>{{ feed.content }}</p>
              </div>
              
              <div class="feed-actions">
                <button class="action-btn like-btn" (click)="toggleLike(feed)" [class.active]="feed.liked">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="action-count">{{ feed.likes }}</span>
                </button>
                <button class="action-btn comment-btn">
                  <span class="material-symbols-outlined">chat_bubble</span>
                  <span class="action-count">0</span>
                </button>
                <button class="action-btn share-btn">
                  <span class="material-symbols-outlined">share</span>
                  <span class="action-text">Share</span>
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  } @else {
    <div class="loading">
      <p>Loading community...</p>
    </div>
  }
</div>
